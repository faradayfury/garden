// CSS Custom Properties for Theme Support
:root {
  // Light theme (default)
  --color-primary: #403E3C;
  --color-text: #403E3C;
  --color-subtext: #9F9D96;
  --color-border: #E6E4D9;
  --color-separator: #E6E4D9;
  --color-box-background: #F2F0E5;
  --color-background: #FFFCF0;
  --color-blue: #205EA6;
  --color-cyan: #24837B;
  --color-green: #66800B;
  
  // Smooth transitions for theme changes
  transition: color 300ms ease, background-color 300ms ease, border-color 300ms ease;
}

// Dark theme
[data-theme="dark"] {
  --color-primary: #D1D0CA;    // base-200 for white text
  --color-text: #D1D0CA;       // base-200 for white text
  --color-subtext: #878580;    // base-600 for remaining
  --color-border: #878580;     // base-600 for remaining
  --color-separator: #282726;  // base-850 for separators
  --color-box-background: #403E3C; // Slightly lighter than background for contrast
  --color-background: #100F0F; // black background
  --color-blue: #4385BE;
  --color-cyan: #3AA99F;
  --color-green: #879A39;
}

// Flexoki theme variables using CSS custom properties
$color-primary: var(--color-primary);
$color-text: var(--color-text);
$color-subtext: var(--color-subtext);
$color-border: var(--color-border);
$color-separator: var(--color-separator);
$color-box-background: var(--color-box-background);
$color-background: var(--color-background);
$color-blue: var(--color-blue);
$color-cyan: var(--color-cyan);
$color-green: var(--color-green);
$border-radius: 4px;
// Local Geist font face
@font-face {
  font-family: 'Geist';
  src: url('/assets/Geist-VariableFont_wght.ttf') format('truetype');
  font-weight: 100 900;
  font-style: normal;
  font-display: swap;
}

// Local Geist Mono font face
@font-face {
  font-family: 'Geist Mono';
  src: url('/assets/GeistMono-VariableFont_wght.ttf') format('truetype');
  font-weight: 100 900;
  font-style: normal;
  font-display: swap;
}

$font-family: "Geist", sans-serif;

body {
  box-sizing: content-box;
  font-family: $font-family;
  margin: 0 auto;
  line-height: 150%; // 150% line spacing
  padding: 0 6vw 4vh 6vw; // Remove top padding, keep others
  overflow-x: hidden;
  color: $color-text;
  font-size: 18px;
  max-width: 600px;
  text-align: left;
  background: $color-background;
  font-weight: 350; // Default body text weight
  transition: color 300ms ease, background-color 300ms ease;
}

time {
  display: block;
  color: $color-subtext;
  margin: 0.5em 0 1em;
  font-family: "Geist Mono", monospace;
  transition: color 300ms ease;
}

footer {
  margin: 0;
  margin-top: 40px;
  padding-top: 40px;
  font-size: 16px;
  color: $color-subtext;
  border-top: 1px solid $color-border;
  transition: color 300ms ease, border-color 300ms ease;
}

img {
  max-width: 100%;
  display: block;
  margin: 0 auto;
  max-height: 75vh;
  border-radius: $border-radius;
  // Optimize image rendering
  image-rendering: auto;
  image-rendering: crisp-edges;
  image-rendering: -webkit-optimize-contrast;
}

blockquote {
  padding: 1.5em;
  margin: 0;
  font-size: 0.88em;
  background: $color-box-background;
  border-radius: $border-radius;
  transition: background-color 300ms ease;

  p {
    margin: 0;
  }
}

hr {
  width: 100%;
  border: 0;
  height: 1px;
  margin: 1.5em 0;
  background: $color-separator;
  transition: background-color 300ms ease;
}

h1,
h2,
h3,
h4,
h5,
h6 {
  line-height: 1.3;
  margin-bottom: 0.5em;
  margin-top: 2em;
  padding-bottom: 0;
  font-weight: 350;
  color: $color-primary;
  transition: color 300ms ease;
}

p {
  font-weight: 350;
}

br {
  display: block;
  margin: 0.5em 0;
  content: "";
}

ul {
  margin: 1em 0;
  padding-left: 1em;
}

ul li {
  margin: 0.25em 0;
}

h1 {
  margin-top: 0;
  font-size: 1.8em;
}

h2 {
  font-size: 1.4em;
}

h3 {
  font-size: 1.2em;
  margin-top: 1.5em;
  margin-bottom: 0.5em;
  font-weight: 350;
  color: $color-primary;
}

a {
  padding: 0;
  text-decoration: none;
  color: $color-text;
  transition: color 200ms ease;
  
  // Only apply hover effects on devices that support hover (desktop)
  @media (hover: hover) {
    &:hover {
      color: $color-cyan;
    }
  }
  
  &:after {
    content: "";
  }
}

*:focus {
  outline: none;
}

*:focus-visible {
  outline: 1px solid $color-cyan;
  outline-offset: 2px;
}

a:focus:not(:focus-visible),
button:focus:not(:focus-visible) {
  outline: none;
}

nav {
  margin: 56px 0 88px;
}

// Note pages should have more spacing
body.note-page nav {
  margin: 56px 0 160px;
}

nav > div {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.nav-links {
  margin-left: auto;
  display: flex;
  align-items: baseline;
  gap: 1em;
}

.nav-link {
  color: $color-subtext; // base-400 color for navigation links
  font-weight: 350; // Match index page font weight
  text-decoration: none;
  line-height: 1;
  display: inline-block;
  vertical-align: baseline;
  
  // Only apply hover effects on devices that support hover (desktop)
  @media (hover: hover) {
    &:hover {
      color: $color-cyan; // Same hover effect as other links
    }
  }
}

// Theme toggle button styling
.theme-toggle {
  background: none;
  border: none;
  cursor: pointer;
  padding: 0;
  margin: 0;
  display: inline-block;
  color: $color-subtext;
  position: relative;
  transition: color 200ms ease, transform 200ms ease;
  vertical-align: baseline;
  line-height: 1;
  transform: translateY(2px); // Fine-tune vertical position
  
  // Only apply hover effects on devices that support hover (desktop)
  @media (hover: hover) {
    &:hover {
      color: $color-cyan;
    }
  }
  
  &:focus {
    outline: none;
  }
  
  &:focus-visible {
    outline: 1px solid $color-cyan;
    outline-offset: 2px;
  }
}

.theme-icon {
  display: block;
  width: 16px;
  height: 16px;
  transition: opacity 300ms ease;
}

// Show moon icon in light mode, sun icon in dark mode
.sun-icon,
.moon-icon {
  position: absolute;
  top: 0;
  left: 0;
  transition: opacity 300ms ease;
}

.sun-icon {
  opacity: 0;
}

.moon-icon {
  opacity: 1;
}

[data-theme="dark"] .sun-icon {
  opacity: 1;
}

[data-theme="dark"] .moon-icon {
  opacity: 0;
}

// Dark mode font weight adjustments for visual consistency
[data-theme="dark"] {
  body {
    font-weight: 300; // Lighter than 350 for dark mode
  }
  
  h1, h2, h3, h4, h5, h6 {
    font-weight: 300; // Lighter than 350 for headings
  }
  
  p {
    font-weight: 300; // Lighter than 350 for paragraphs
  }
  
  .nav-link {
    font-weight: 300 !important; // Lighter than 350 for nav links
  }
  
  .site-title {
    font-weight: 350; // Slightly lighter than 400
  }
  
  .section-title {
    font-weight: 300; // Lighter than 350
  }
  
  .back-button {
    font-weight: 300; // Lighter than 350
  }
  
  .lightbox-caption {
    font-weight: 300; // Lighter than 350
  }
}

// Apply consistent header styling across all pages
nav a {
  font-weight: 350 !important; // Ensure all nav links use 350 weight
}

// Dropdown styling
.dropdown {
  position: relative;
  display: inline-block;
}

.dropdown-toggle {
  background: none;
  border: none;
  cursor: pointer;
  padding: 0;
  margin: 0;
  color: $color-subtext;
  font-weight: 350;
  font-size: 18px;
  font-family: $font-family;
  display: inline-flex;
  align-items: center;
  gap: 0.5em;
  transition: color 200ms ease;
  line-height: 1;
  vertical-align: baseline;
  
  // Only apply hover effects on devices that support hover (desktop)
  @media (hover: hover) {
    &:hover {
      color: $color-cyan;
    }
  }
  
  &:focus {
    outline: none;
  }
  
  &:focus-visible {
    outline: 1px solid $color-cyan;
    outline-offset: 2px;
  }
}

.dropdown-arrow {
  transition: transform 200ms ease;
}

.dropdown.open .dropdown-arrow {
  transform: rotate(180deg);
}

.dropdown-menu {
  position: absolute;
  top: 100%;
  right: 0;
  background: $color-background;
  border: 1px solid $color-border;
  border-radius: $border-radius;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  min-width: 160px;
  opacity: 0;
  visibility: hidden;
  transform: translateY(-8px);
  transition: opacity 200ms ease, visibility 200ms ease, transform 200ms ease;
  z-index: 1000;
  padding: 0.5em 0;
}

.dropdown.open .dropdown-menu {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}

.dropdown-item {
  display: block;
  padding: 0.5em 1em;
  color: $color-text;
  text-decoration: none;
  font-size: 16px;
  font-weight: 350;
  transition: background-color 200ms ease, color 200ms ease;
  
  // Only apply hover effects on devices that support hover (desktop)
  @media (hover: hover) {
    &:hover {
      background: $color-box-background;
      color: $color-cyan;
    }
  }
}

// Dark mode adjustments for dropdown
[data-theme="dark"] .dropdown-menu {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

// Site title specific styling
.site-title {
  color: $color-text; // base-800 color for site title
  font-weight: 400;
  font-size: 18px;
  text-decoration: none;
  
  // Only apply hover effects on devices that support hover (desktop)
  @media (hover: hover) {
    &:hover {
      color: $color-cyan; // Same hover effect as other links
    }
  }
}

#notes-entry-container {
  display: block;
}

.backlink-box {
  background: $color-box-background;
  padding: 1em;
  border-radius: $border-radius;
  transition: background-color 300ms ease;
}

code {
  background: $color-box-background;
  padding: 0.1em 0.2em;
  border-radius: 4px;
  color: $color-text;
  transition: background-color 300ms ease, color 300ms ease;
}

.invalid-link {
  color: $color-subtext;
  cursor: help;
  background: $color-box-background;
  padding: 0 0.1em;
  transition: color 300ms ease, background-color 300ms ease;
}

.invalid-link-brackets {
  color: #B7B5AC; // tx-3 (faint text)
  cursor: help;
}

.photo-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-gap: 1em;
  margin: 2em 0;
}

.photo-placeholder {
  width: 100%;
  aspect-ratio: 5 / 4;
  background: $color-box-background;
  border-radius: $border-radius;
  border: 1px solid $color-border;
  transition: background-color 300ms ease, border-color 300ms ease;
}

// Homepage Layout Control
.section {
  margin-bottom: 56px; // Space after separator line
  padding-bottom: 56px; // Space before separator line
  border-bottom: 1px solid $color-separator; // Uses CSS variable for theme support
  transition: border-color 300ms ease;
  
  &:last-child {
    margin-bottom: 0;
    padding-bottom: 0;
    border-bottom: none; // Remove separator from last section
  }
}

.section-title {
  margin-bottom: 24px; // 24px space between title and body
  margin-top: 0;
  color: $color-subtext; // base-400 color
  font-size: 18px;
  font-weight: 350;
  font-family: "Geist Mono", monospace;
  transition: color 300ms ease;
}

.section-content, 
.section-description {
  margin-bottom: 40px; // 40px space between body and next element
  margin-top: 0;
}

// Fix About section extra spacing
.section-about .section-content {
  margin-bottom: 0; // Remove extra space for About section
}

// Work Section Layout
.work-list {
  display: flex;
  flex-direction: column;
  gap: 8px; // 8px spacing between blog items
}

.work-item {
  display: flex;
  align-items: flex-start;
  gap: 24px; // 24px spacing between date and text
}

.work-date {
  color: $color-subtext;
  min-width: 4em; // Control date column width
  flex-shrink: 0;
  font-family: "Geist Mono", monospace;
  transition: color 300ms ease;
}

.work-spacer {
  display: none; // Remove the dotted line
}

.work-title {
  text-decoration: underline;
}

// Photography Section Layout
.section-photography {
  .photo-grid {
    // Break out of the 600px container
    width: 100vw;
    margin-left: calc(-50vw + 50%);
    
    // Center the grid content with proper constraints
    display: grid;
    grid-template-columns: repeat(4, minmax(0, 300px));
    justify-content: center;
    gap: 20px;
    margin-top: 56px;
    margin-bottom: 200px;
    padding: 0 6vw;
    box-sizing: border-box;
  }
}

// Camera link styling
.camera-link {
  color: $color-text;
  text-decoration: underline;
  transition: color 200ms ease;
  cursor: pointer;
  
  // Only apply hover effects on devices that support hover (desktop)
  @media (hover: hover) {
    &:hover {
      color: $color-cyan;
    }
  }
}

.photo-placeholder {
  background: $color-box-background;
  border-radius: $border-radius;
  border: 1px solid $color-border;
  aspect-ratio: 5 / 4;
}

// Photo item styling
.photo-item {
  position: relative;
  aspect-ratio: 5 / 4;
  border-radius: $border-radius;
  overflow: hidden;
  cursor: pointer;
  transition: transform 200ms ease;
  
  // Only apply hover effects on devices that support hover (desktop)
  @media (hover: hover) {
    &:hover {
      transform: scale(1.02);
    }
  }
}

.photo-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: $border-radius;
  transition: opacity 200ms ease;
  // Optimize photo loading and rendering
  image-rendering: auto;
  image-rendering: crisp-edges;
  image-rendering: -webkit-optimize-contrast;
  // Prevent layout shift during loading
  background-color: $color-box-background;
}

/* Offset second and fourth columns using nth-child */
.photo-placeholder:nth-child(4n+2),
.photo-placeholder:nth-child(4n),
.photo-item:nth-child(4n+2),
.photo-item:nth-child(4n) {
  transform: translateY(40px);
}

/* Ensure hover transform works with the offset */
@media (hover: hover) {
  .photo-item:nth-child(4n+2):hover,
  .photo-item:nth-child(4n):hover {
    transform: translateY(40px) scale(1.02);
  }
}

/* Simple Photo Lightbox */
.photo-lightbox {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.9);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.photo-lightbox.show {
  display: flex;
}

.lightbox-content {
  position: relative;
  max-width: 90%;
  max-height: 90%;
  text-align: center;
}

.lightbox-image {
  max-width: 100%;
  max-height: 70vh;
  object-fit: contain;
  border-radius: 0;
}

.lightbox-info {
  background: rgba(255, 255, 255, 0.95);
  padding: 20px;
  margin-top: 20px;
  border-radius: 8px;
  text-align: left;
  max-width: 500px;
}

.lightbox-caption {
  font-size: 18px;
  font-weight: 350;
  margin-bottom: 8px;
  color: $color-primary;
  transition: color 300ms ease;
}

.lightbox-meta {
  font-size: 14px;
  color: $color-subtext;
  margin-bottom: 12px;
  font-family: "Geist Mono", monospace;
  transition: color 300ms ease;
}

.lightbox-bio {
  font-size: 16px;
  line-height: 1.5;
  color: $color-text;
  transition: color 300ms ease;
}

.lightbox-close {
  display: none;
}

.view-all-container {
  margin-top: 1.5em; // Control space above "view all" link
  text-align: right;
  margin-right: 0; // Ensure it's pushed to the very right
  width: 100%; // Use full width to ensure proper right alignment
}

.view-all-link {
  color: $color-subtext;
  font-size: 0.9em;
  transition: color 300ms ease;
}

// Writing Section Layout
.writing-list {
  display: flex;
  flex-direction: column;
  gap: 8px; // 8px spacing between blog items
}

.writing-item {
  display: flex;
  align-items: flex-start;
  gap: 24px; // 24px spacing between date and text
}

.writing-date {
  color: $color-subtext;
  min-width: 4em; // Control date column width
  flex-shrink: 0;
  font-family: "Geist Mono", monospace;
  transition: color 300ms ease;
}

.writing-spacer {
  display: none; // Remove the dotted line
}

.writing-title {
  text-decoration: underline;
}

// Back button styling for notes
.back-button-container {
  margin: 0 0 calc(2em - 16px) 0;
}

// Note-specific spacing (only for _notes folder)
.note-layout time {
  margin: 0.5em 0 0.2em; // Significantly reduced spacing for notes only
}

.back-button {
  color: $color-subtext;
  font-size: 18px;
  font-weight: 350;
  font-family: "Geist Mono", monospace;
  text-decoration: none;
  transition: color 200ms ease;
  
  // Only apply hover effects on devices that support hover (desktop)
  @media (hover: hover) {
    &:hover {
      color: $color-cyan;
    }
  }
  
  &:after {
    content: "";
  }
}

// Responsive adjustments
@media (max-width: 600px) {
  .section {
    margin-bottom: 3em; // Smaller spacing on mobile
  }
  
  // Hide email link on mobile
  .nav-link[href*="mailto:"] {
    display: none;
  }
  
  .work-item {
    flex-direction: row;
    align-items: flex-start;
    gap: 12px; // Space between date and title on mobile
    width: 100%;
  }
  
  .work-date {
    flex-shrink: 0;
    min-width: 4em;
  }
  
  .work-title {
    flex: 1;
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.4;
  }
  
  .work-list {
    gap: 24px; // Reduced spacing between work items on mobile
  }
  
  .work-spacer {
    display: none; // Hide spacers on mobile
  }
  
  // Photography responsive: 2 columns on mobile
  .section-photography .photo-grid {
    grid-template-columns: repeat(2, minmax(0, 200px));
    justify-content: center;
    gap: 15px;
    padding: 0 4vw;
    margin-top: 40px;
    margin-bottom: 120px;
  }
  
  /* Reset desktop offsets and apply to second column only */
  .photo-placeholder:nth-child(4n+2),
  .photo-placeholder:nth-child(4n) {
    transform: translateY(0);
  }
  
  .photo-placeholder:nth-child(2n) {
    transform: translateY(30px);
  }
}

/* Tablet responsive: 3 columns */
@media (max-width: 900px) and (min-width: 601px) {
  .section-photography .photo-grid {
    // Maintain the breakout for tablet
    width: 100vw;
    margin-left: calc(-50vw + 50%);
    grid-template-columns: repeat(3, minmax(0, 250px));
    justify-content: center;
    gap: 18px;
    padding: 0 5vw;
    box-sizing: border-box;
    margin-bottom: 160px;
  }
  
  /* Reset desktop offsets for tablet */
  .photo-placeholder:nth-child(4n+2),
  .photo-placeholder:nth-child(4n) {
    transform: translateY(0);
  }
  
  /* Apply offset to second column (every 3rd item starting from 2nd) */
  .photo-placeholder:nth-child(3n+2) {
    transform: translateY(35px);
  }
}
